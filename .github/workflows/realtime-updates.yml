name: âš¡ Real-time Profile Updates

on:
  schedule:
    - cron: '*/30 * * * *'  # Every 30 minutes
  workflow_dispatch:

jobs:
  update-realtime:
    runs-on: ubuntu-latest
    name: ğŸ”„ Live Data Sync
    
    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ Install dependencies
        run: |
          pip install requests beautifulsoup4 feedparser pytz

      - name: ğŸš€ Update dynamic content
        run: |
          python3 << 'EOF'
          import requests
          import json
          import random
          from datetime import datetime
          import pytz
          import re

          # Tech quotes for daily rotation
          quotes = [
              "The best way to predict the future is to invent it. - Alan Kay",
              "Code is like humor. When you have to explain it, it's bad. - Cory House",
              "First, solve the problem. Then, write the code. - John Johnson",
              "AI is the new electricity. - Andrew Ng",
              "Machine learning is the last invention humanity will ever need. - Nick Bostrom",
              "Innovation distinguishes between a leader and a follower. - Steve Jobs",
              "The future belongs to those who believe in the beauty of their dreams. - Eleanor Roosevelt",
              "Artificial Intelligence is no match for natural stupidity. - Anonymous",
              "In order to be irreplaceable, one must always be different. - Coco Chanel",
              "Knowledge is power. - Francis Bacon"
          ]

          # Read current README
          with open('README.md', 'r', encoding='utf-8') as f:
              content = f.read()

          # Update timestamp
          ist = pytz.timezone('Asia/Kolkata')
          current_time = datetime.now(ist).strftime('%Y-%m-%d %H:%M IST')
          content = re.sub(r'â° Last Updated: .*', f'â° Last Updated: {current_time}', content)

          # Update daily quote (changes once per day)
          day_of_year = datetime.now().timetuple().tm_yday
          daily_quote = quotes[day_of_year % len(quotes)]
          content = re.sub(r'ğŸ’­ Daily Wisdom: .*', f'ğŸ’­ Daily Wisdom: {daily_quote}', content)

          # Get GitHub stats
          try:
              user_response = requests.get('https://api.github.com/users/prsdx', timeout=10)
              if user_response.status_code == 200:
                  user_data = user_response.json()
                  repo_count = user_data.get('public_repos', 0)
                  
                  # Get total stars
                  repos_response = requests.get('https://api.github.com/users/prsdx/repos?per_page=100', timeout=10)
                  if repos_response.status_code == 200:
                      repos_data = repos_response.json()
                      total_stars = sum(repo.get('stargazers_count', 0) for repo in repos_data)
                      
                      # Update stats in README
                      content = re.sub(r'ğŸ“š Repositories: \d+', f'ğŸ“š Repositories: {repo_count}', content)
                      content = re.sub(r'â­ Total Stars: \d+', f'â­ Total Stars: {total_stars}', content)
          except Exception as e:
              print(f"Error fetching GitHub stats: {e}")

          # Get weather info (using wttr.in)
          try:
              weather_response = requests.get('http://wttr.in/Mumbai?format=3', timeout=10)
              if weather_response.status_code == 200:
                  weather_info = weather_response.text.strip()
                  content = re.sub(r'ğŸŒ¡ï¸ Weather: <!-- WEATHER -->.*', f'ğŸŒ¡ï¸ Weather: <!-- WEATHER --> {weather_info}', content)
          except Exception as e:
              print(f"Error fetching weather: {e}")

          # Add coding status based on time
          hour = datetime.now(ist).hour
          if 9 <= hour <= 18:
              status = "ğŸš€ Actively coding"
          elif 19 <= hour <= 23:
              status = "ğŸŒ™ Evening development"
          elif 0 <= hour <= 6:
              status = "ğŸ˜´ Probably sleeping"
          else:
              status = "â˜• Coffee break time"
          
          content = re.sub(r'ğŸµ Currently: .*', f'ğŸµ Currently: {status}', content)

          # Write updated content
          with open('README.md', 'w', encoding='utf-8') as f:
              f.write(content)

          print("âœ… Dynamic content updated successfully!")
          EOF

      - name: ğŸ’¾ Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ğŸ¤– Real-time update: $(date -u +'%Y-%m-%d %H:%M UTC')"
            git push
          fi
